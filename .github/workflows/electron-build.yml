name: Electron Build

on:
  push:
    branches: [ main ]

jobs:
  release:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
      
    steps:
    - name: Check out Git repository
      uses: actions/checkout@v2
    - name: Install Node.js, NPM and Yarn
      uses: actions/setup-node@v1
      with:
        node-version: 16
    - name: Install Independecies
      run: npm i && npm ci
    - name: Build React app
      run: npm run react-build
    - name: Install snapcraft
      run: sudo snap install snapcraft --classic
      if: runner.os == 'Linux'
    - name: Test electron app
      run: npm run electron-build
    - name: Build/Release Electron app
      uses: samuelmeuli/action-electron-builder@v1
      with: 
        github_token: ${{ secrets.MY_GITHUB_TOKEN  }}
        release_tag: ${{ startsWith(github.ref, 'refs/tags/v') }}
        release: ${{ startsWith(github.ref, 'refs/tags/v') }}
